<!DOCTYPE html>
<html>
<head>
  <title>Onboarding</title>
  <link rel="stylesheet" href="tailwind.css">
</head>
<body>
<div class="progress-container">
  <div id="progressBar" class="progress-bar"></div>
</div>
<div class="auth-container">
  <div class="auth-card">
    <h2>B·∫°n l√† ai?</h2>

    <select id="role" class="auth-input-group">
      <option value="student">H·ªçc sinh / Sinh vi√™n</option>
      <option value="lecturer">Gi·∫£ng vi√™n</option>
      <option value="researcher">Nh√† nghi√™n c·ª©u</option>
    </select>

    <button class="auth-button" onclick="selectRole()">Ti·∫øp t·ª•c</button>

    <div id="userStoryBox" style="margin-top:20px;"></div>
    <div id="surveyBox"></div>
  </div>
</div>

<script>

function selectRole() {
  const role = document.getElementById("role").value;
  const email = localStorage.getItem("email");
  document.getElementById("progressBar").style.width = "40%";
  fetch("/api/select-role", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, role }),
  });

  renderUserStory(role);
  renderSurvey(role);
}

function renderUserStory(role) {
  const box = document.getElementById("userStoryBox");

  let story = "";

  if (role === "student") {
    story = `
    <p><strong>User Story:</strong><br>
    L√† m·ªôt h·ªçc sinh/sinh vi√™n, t√¥i mu·ªën c√≥ m·ªôt l·ªô tr√¨nh h·ªçc t·∫≠p c√° nh√¢n h√≥a ƒë·ªÉ c√≥ th·ªÉ tƒÉng thu nh·∫≠p v√† c∆° h·ªôi ngh·ªÅ nghi·ªáp.</p>`;
  }

  if (role === "lecturer") {
    story = `
    <p><strong>User Story:</strong><br>
    V·ªõi t∆∞ c√°ch l√† gi·∫£ng vi√™n, t√¥i mu·ªën t·∫°o ra nh·ªØng kh√≥a h·ªçc c√≥ s·ª©c ·∫£nh h∆∞·ªüng l·ªõn ƒë·ªÉ thu h√∫t th√™m sinh vi√™n v√† tƒÉng thu nh·∫≠p.</p>`;
  }

  box.innerHTML = story;
}

function renderSurvey(role) {
  const box = document.getElementById("surveyBox");
  document.getElementById("progressBar").style.width = "40%";
  let questions = [];

  if (role === "student") {
    questions = [
      "B·∫°n mu·ªën tƒÉng thu nh·∫≠p bao nhi√™u % sau kh√≥a h·ªçc?",
      "B·∫°n mu·ªën ƒë·∫°t v·ªã tr√≠ c√¥ng vi·ªác n√†o?",
      "B·∫°n c√≥ c·∫ßn ch·ª©ng ch·ªâ qu·ªëc t·∫ø kh√¥ng?",
      "B·∫°n c√≥ bao nhi√™u gi·ªù/tu·∫ßn ƒë·ªÉ ƒë·∫ßu t∆∞ cho vi·ªác h·ªçc?"
    ];
  }

  if (role === "lecturer") {
    questions = [
      "B·∫°n mu·ªën tƒÉng bao nhi√™u h·ªçc vi√™n trong 6 th√°ng?",
      "B·∫°n c√≥ mu·ªën m·ªü kh√≥a h·ªçc tr·∫£ ph√≠ kh√¥ng?",
      "B·∫°n mu·ªën x√¢y d·ª±ng th∆∞∆°ng hi·ªáu c√° nh√¢n m·∫°nh ƒë·∫øn m·ª©c n√†o?",
      "B·∫°n g·∫∑p kh√≥ khƒÉn g√¨ khi d·∫°y online?"
    ];
  }

  box.innerHTML = "";

  questions.forEach((q, index) => {
    box.innerHTML += `
      <div class="auth-input-group">
        <label>${q}</label>
        <input type="text" id="q${index}">
      </div>
    `;
  });

  box.innerHTML += `
    <button class="auth-button" onclick="submitSurvey()">Ho√†n t·∫•t</button>
  `;
}

async function submitSurvey() {
  const email = localStorage.getItem("email");
  const inputs = document.querySelectorAll("#surveyBox input");
  document.getElementById("progressBar").style.width = "100%";
  let answers = [];
  inputs.forEach(input => answers.push(input.value));

  await fetch("/api/survey", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, answers }),
  });

  // üëâ Login l·∫°i ƒë·ªÉ l·∫•y token m·ªõi
  const password = prompt("Nh·∫≠p l·∫°i m·∫≠t kh·∫©u ƒë·ªÉ ho√†n t·∫•t:");
  
  const res = await fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password }),
  });

  const data = await res.json();
  localStorage.setItem("token", data.token);

  window.location.href = "/";
}

</script>

</body>
</html>