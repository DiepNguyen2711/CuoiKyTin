<!DOCTYPE html>
<<<<<<< Updated upstream
<html>
<head>
  <title>Onboarding</title>
  <link rel="stylesheet" href="tailwind.css">
</head>
<body>
<div class="progress-container">
  <div id="progressBar" class="progress-bar"></div>
</div>
<div class="auth-container">
  <div class="auth-card">
    <h2>B·∫°n l√† ai?</h2>

    <select id="role" class="auth-input-group" onchange="selectRole()">
      <option value="student">H·ªçc sinh / Sinh vi√™n</option>
      <option value="lecturer">Gi·∫£ng vi√™n</option>
      <option value="researcher">Nh√† nghi√™n c·ª©u</option>
    </select>

    <div id="userStoryBox" style="margin-top:20px;"></div>
    <div id="surveyBox"></div>
  </div>
</div>

<script>
// H√†m h·ªó tr·ª£ t·ª± ƒë·ªông l·∫•y CSRF Token t·ª´ Cookie c·ªßa tr√¨nh duy·ªát
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

// Ki·ªÉm tra email (n·∫øu v·∫´n c·∫ßn d√πng email l∆∞u t·∫°m ·ªü localStorage t·ª´ l√∫c ƒëƒÉng k√Ω/ƒëƒÉng nh·∫≠p)
const email = localStorage.getItem("email");
if (!email) {
  alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc!");
  window.location.href = "login.html";
}

function selectRole() {
  const role = document.getElementById("role").value;
  document.getElementById("progressBar").style.width = "40%";
  
  fetch("/api/select-role", {
    method: "POST",
    headers: { 
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken  // üëâ ƒê√≠nh k√®m th·∫ª b·∫£o v·ªá c·ªßa Django
    },
    body: JSON.stringify({ email, role }),
  });

  renderUserStory(role);
  renderSurvey(role);
}

function renderUserStory(role) {
  const box = document.getElementById("userStoryBox");
  let story = "";

  if (role === "student") {
    story = `
    <p><strong>User Story:</strong><br>
    L√† m·ªôt h·ªçc sinh/sinh vi√™n, t√¥i mu·ªën c√≥ m·ªôt l·ªô tr√¨nh h·ªçc t·∫≠p c√° nh√¢n h√≥a ƒë·ªÉ c√≥ th·ªÉ tƒÉng thu nh·∫≠p v√† c∆° h·ªôi ngh·ªÅ nghi·ªáp.</p>`;
  }

  if (role === "lecturer") {
    story = `
    <p><strong>User Story:</strong><br>
    V·ªõi t∆∞ c√°ch l√† gi·∫£ng vi√™n, t√¥i mu·ªën t·∫°o ra nh·ªØng kh√≥a h·ªçc c√≥ s·ª©c ·∫£nh h∆∞·ªüng l·ªõn ƒë·ªÉ thu h√∫t th√™m sinh vi√™n v√† tƒÉng thu nh·∫≠p.</p>`;
  }
  
  if (role === "researcher") {
    story = `
    <p><strong>User Story:</strong><br>
    L√† m·ªôt nh√† nghi√™n c·ª©u, t√¥i mu·ªën c√≥ m·ªôt c√¥ng c·ª• AI h·ªó tr·ª£ ƒë·ªÉ tƒÉng t·ªëc qu√° tr√¨nh nghi√™n c·ª©u v√† ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu c√¥ng b·ªë khoa h·ªçc h∆°n.</p>`;
  }

  box.innerHTML = story;
}

function renderSurvey(role) {
  const box = document.getElementById("surveyBox");
  document.getElementById("progressBar").style.width = "40%";
  let questions = [];

  if (role === "student") {
    questions = [
      "B·∫°n mu·ªën tƒÉng thu nh·∫≠p bao nhi√™u % sau kh√≥a h·ªçc?",
      "B·∫°n mu·ªën ƒë·∫°t v·ªã tr√≠ c√¥ng vi·ªác n√†o?",
      "B·∫°n c√≥ c·∫ßn ch·ª©ng ch·ªâ qu·ªëc t·∫ø kh√¥ng?",
      "B·∫°n c√≥ bao nhi√™u gi·ªù/tu·∫ßn ƒë·ªÉ ƒë·∫ßu t∆∞ cho vi·ªác h·ªçc?"
    ];
  }

  if (role === "lecturer") {
    questions = [
      "B·∫°n mu·ªën tƒÉng bao nhi√™u h·ªçc vi√™n trong 6 th√°ng?",
      "B·∫°n c√≥ mu·ªën m·ªü kh√≥a h·ªçc tr·∫£ ph√≠ kh√¥ng?",
      "B·∫°n mu·ªën x√¢y d·ª±ng th∆∞∆°ng hi·ªáu c√° nh√¢n m·∫°nh ƒë·∫øn m·ª©c n√†o?",
      "B·∫°n g·∫∑p kh√≥ khƒÉn g√¨ khi d·∫°y online?"
    ];
  }
  
  if (role === "researcher") {
    questions = [
      "B·∫°n ƒëang nghi√™n c·ª©u lƒ©nh v·ª±c n√†o?",
      "B·∫°n c·∫ßn AI h·ªó tr·ª£ ·ªü m·ª©c ƒë·ªô n√†o?",
      "M·ª•c ti√™u c√¥ng b·ªë khoa h·ªçc c·ªßa b·∫°n?",
      "B·∫°n d√†nh bao nhi√™u gi·ªù/tu·∫ßn cho nghi√™n c·ª©u?"
    ];
  }

  box.innerHTML = "";

  questions.forEach((q, index) => {
    box.innerHTML += `
      <div class="auth-input-group">
        <label>${q}</label>
        <input type="text" id="q${index}">
      </div>
    `;
  });

  box.innerHTML += `
    <button class="auth-button" onclick="submitSurvey()">Ho√†n t·∫•t</button>
  `;
}

async function submitSurvey() {
  const inputs = document.querySelectorAll("#surveyBox input");
  document.getElementById("progressBar").style.width = "100%";
  
  let answers = [];
  inputs.forEach(input => answers.push(input.value));

  // G·ª≠i API kh·∫£o s√°t
  await fetch("/api/survey", {
    method: "POST",
    headers: { 
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken // üëâ ƒê√≠nh k√®m th·∫ª b·∫£o v·ªá c·ªßa Django
    },
    body: JSON.stringify({ email, answers }),
  });

  // Do Django ƒë√£ d√πng Session Cookie, ch·ªâ c·∫ßn chuy·ªÉn th·∫≥ng user v·ªÅ trang ch·ªß!
  alert("C·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng!");
  window.location.href = "/";
}

</script>

</body>
</html>
=======
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Onboarding - HourSkill</title>
  <link rel="stylesheet" href="tailwind.css">
</head>
<body>
  <div class="progress-container">
    <div id="progressBar" class="progress-bar"></div>
  </div>

  <div class="auth-container">
    <div class="auth-card">
      <h2>B·∫°n l√† ai?</h2>

      <div class="auth-input-group">
        <label for="role">Ch·ªçn vai tr√≤</label>
        <select id="role" onchange="selectRole()">
          <option value="student">H·ªçc sinh / Sinh vi√™n</option>
          <option value="lecturer">Gi·∫£ng vi√™n</option>
          <option value="researcher">Nh√† nghi√™n c·ª©u</option>
        </select>
      </div>

      <div id="userStoryBox" style="margin-top: 20px;"></div>
      <div id="surveyBox"></div>

      <div class="auth-error" id="error" style="margin-top: 12px;"></div>
    </div>
  </div>

  <script>
    const token = localStorage.getItem('token');
    const email = localStorage.getItem('email');
    if (!token || !email) {
      window.location.href = 'login.html';
    }

    function setProgress(value) {
      document.getElementById('progressBar').style.width = `${value}%`;
    }

    function selectRole() {
      const role = document.getElementById('role').value;
      setProgress(40);

      fetch('/api/select-role/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ email, role })
      }).catch(() => {
        document.getElementById('error').innerText = 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t vai tr√≤, vui l√≤ng th·ª≠ l·∫°i.';
      });

      renderUserStory(role);
      renderSurvey(role);
    }

    function renderUserStory(role) {
      const box = document.getElementById('userStoryBox');
      let story = '';

      if (role === 'student') {
        story = `
          <p><strong>User Story:</strong><br>
          L√† m·ªôt h·ªçc sinh/sinh vi√™n, t√¥i mu·ªën c√≥ m·ªôt l·ªô tr√¨nh h·ªçc t·∫≠p c√° nh√¢n h√≥a ƒë·ªÉ c√≥ th·ªÉ tƒÉng thu nh·∫≠p v√† c∆° h·ªôi ngh·ªÅ nghi·ªáp.</p>`;
      }

      if (role === 'lecturer') {
        story = `
          <p><strong>User Story:</strong><br>
          V·ªõi t∆∞ c√°ch l√† gi·∫£ng vi√™n, t√¥i mu·ªën t·∫°o ra nh·ªØng kh√≥a h·ªçc c√≥ s·ª©c ·∫£nh h∆∞·ªüng l·ªõn ƒë·ªÉ thu h√∫t th√™m sinh vi√™n v√† tƒÉng thu nh·∫≠p.</p>`;
      }
      
      if (role === 'researcher') {
        story = `
          <p><strong>User Story:</strong><br>
          L√† m·ªôt nh√† nghi√™n c·ª©u, t√¥i mu·ªën c√≥ m·ªôt c√¥ng c·ª• AI h·ªó tr·ª£ ƒë·ªÉ tƒÉng t·ªëc qu√° tr√¨nh nghi√™n c·ª©u v√† ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu c√¥ng b·ªë khoa h·ªçc h∆°n.</p>`;
      }

      box.innerHTML = story;
    }

    function renderSurvey(role) {
      const box = document.getElementById('surveyBox');
      setProgress(40);
      let questions = [];

      if (role === 'student') {
        questions = [
          'B·∫°n mu·ªën tƒÉng thu nh·∫≠p bao nhi√™u % sau kh√≥a h·ªçc?',
          'B·∫°n mu·ªën ƒë·∫°t v·ªã tr√≠ c√¥ng vi·ªác n√†o?',
          'B·∫°n c√≥ c·∫ßn ch·ª©ng ch·ªâ qu·ªëc t·∫ø kh√¥ng?',
          'B·∫°n c√≥ bao nhi√™u gi·ªù/tu·∫ßn ƒë·ªÉ ƒë·∫ßu t∆∞ cho vi·ªác h·ªçc?'
        ];
      }

      if (role === 'lecturer') {
        questions = [
          'B·∫°n mu·ªën tƒÉng bao nhi√™u h·ªçc vi√™n trong 6 th√°ng?',
          'B·∫°n c√≥ mu·ªën m·ªü kh√≥a h·ªçc tr·∫£ ph√≠ kh√¥ng?',
          'B·∫°n mu·ªën x√¢y d·ª±ng th∆∞∆°ng hi·ªáu c√° nh√¢n m·∫°nh ƒë·∫øn m·ª©c n√†o?',
          'B·∫°n g·∫∑p kh√≥ khƒÉn g√¨ khi d·∫°y online?'
        ];
      }
      
      if (role === 'researcher') {
        questions = [
          'B·∫°n ƒëang nghi√™n c·ª©u lƒ©nh v·ª±c n√†o?',
          'B·∫°n c·∫ßn AI h·ªó tr·ª£ ·ªü m·ª©c ƒë·ªô n√†o?',
          'M·ª•c ti√™u c√¥ng b·ªë khoa h·ªçc c·ªßa b·∫°n?',
          'B·∫°n d√†nh bao nhi√™u gi·ªù/tu·∫ßn cho nghi√™n c·ª©u?'
        ];
      }

      box.innerHTML = '';

      questions.forEach((q, index) => {
        box.innerHTML += `
          <div class="auth-input-group">
            <label>${q}</label>
            <input type="text" id="q${index}">
          </div>
        `;
      });

      box.innerHTML += `
        <button class="auth-button" onclick="submitSurvey()">Ho√†n t·∫•t</button>
      `;
    }

    async function submitSurvey() {
      const errorText = document.getElementById('error');
      errorText.innerText = '';
      const inputs = document.querySelectorAll('#surveyBox input');
      setProgress(100);

      const answers = Array.from(inputs).map(input => input.value.trim());

      try {
        const res = await fetch('/api/survey/', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ email, answers })
        });

        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          errorText.innerText = data.message || 'L∆∞u kh·∫£o s√°t th·∫•t b·∫°i, th·ª≠ l·∫°i.';
          setProgress(40);
          return;
        }

        alert('C·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng!');
        window.location.href = 'main.html';
      } catch (err) {
        errorText.innerText = 'L·ªói k·∫øt n·ªëi m·∫°ng, vui l√≤ng th·ª≠ l·∫°i.';
        setProgress(40);
      }
    }

    // Kh·ªüi t·∫°o m·∫∑c ƒë·ªãnh
    renderUserStory('student');
    renderSurvey('student');
  </script>
</body>
</html>
>>>>>>> Stashed changes
